import{u as y,c as f,g,a as w,n as v,b as I,d as E,e as b}from"./DLOaviNJ.js";import{$ as s,m as h,p as D}from"./B7Bdb3zK.js";import{c as p}from"./ubnEN69k.js";import{d as x}from"./DuAV58dt.js";import"./BVfwVV_A.js";import"./CytyAsPR.js";import"./WCN155e2.js";const R="http",F=c=>{const r=(e="")=>h(c.base,e.replace(/:/g,"/")),n=(e="")=>h(c.base,(e||"/").replace(/:/g,"/"),":"),i=(e,t=null)=>{if(e?.response?.status===404)return t;throw e},a=(e,t)=>{const o={...t,...c.headers,...e?.headers};return e?.ttl&&!o["x-ttl"]&&(o["x-ttl"]=e.ttl+""),o};return{name:R,options:c,hasItem(e,t){return s(r(e),{method:"HEAD",headers:a(t)}).then(()=>!0).catch(o=>i(o,!1))},async getItem(e,t){return await s(r(e),{headers:a(t)}).catch(i)},async getItemRaw(e,t){return(await s.raw(r(e),{responseType:"arrayBuffer",headers:a(t,{accept:"application/octet-stream"})}).catch(i))._data},async getMeta(e,t){const o=await s.raw(r(e),{method:"HEAD",headers:a(t)});let d,u;const m=o.headers.get("last-modified");m&&(d=new Date(m));const l=o.headers.get("x-ttl");return l&&(u=Number.parseInt(l,10)),{status:o.status,mtime:d,ttl:u}},async setItem(e,t,o){await s(r(e),{method:"PUT",body:t,headers:a(o)})},async setItemRaw(e,t,o){await s(r(e),{method:"PUT",body:t,headers:a(o,{"content-type":"application/octet-stream"})})},async removeItem(e,t){await s(r(e),{method:"DELETE",headers:a(t)})},async getKeys(e,t){const o=await s(n(e),{headers:a(t)});return Array.isArray(o)?o:[]},async clear(e,t){await s(n(e),{method:"DELETE",headers:a(t)})}}};function U(c,r){const n=y(c,r);if(!D().public.studio.dev)return n;n.meta.dev=!0;const i=f({driver:F({base:"/__nuxt_studio/dev/content"})});return n.app.requestRerender=()=>{},n.document.db.upsert=x(async(a,e)=>{const t=g(a,p);if(!t)throw new Error(`Collection not found for fsPath: ${a}`);const o=w(a,t),d=v(o,t,e),u=await n.document.generate.contentFromDocument(d);await i.setItem(a,u,{headers:{"content-type":"text/plain"}})},100),n.document.db.delete=async a=>{await i.removeItem(a)},n.on.documentUpdate=a=>{(void 0).on("nuxt-content:update",e=>{const t=I(e.key,p),o=E(e.key,t.source),d=b(e.key,o),u=e.queries.length===0;a(d,u?"remove":"update")})},n.on.mediaUpdate=a=>{(void 0).on("nuxt-studio:media:update",e=>{a(e.id,e.type)})},n}export{U as useStudioHost};
